[
   {
        "CVE_ID": "NA",
        "CWE_ID": "NA",
        "category": "security",
        "commit_id": "ce5246b972f7514af899a63c0faf831d05ed5ee1",
        "commit_message": "commit ce5246b972f7514af899a63c0faf831d05ed5ee1\nAuthor: David Teigland <teigland@redhat.com>\nDate:   Mon Jan 14 15:48:58 2008 -0600\n\n    dlm: fix possible use-after-free\n    \n    The dlm_put_lkb() can free the lkb and its associated ua structure,\n    so we can't depend on using the ua struct after the put.\n    \n    Signed-off-by: David Teigland <teigland@redhat.com>\n\n",
        "diff_code": "diff --git a/fs/dlm/user.c b/fs/dlm/user.c\nindex 4f741546f4bb..eb6164816948 100644\n--- a/fs/dlm/user.c\n+++ b/fs/dlm/user.c\n@@ -236,12 +236,12 @@ void dlm_user_add_ast(struct dlm_lkb *lkb, int type)\n \tspin_unlock(&proc->asts_spin);\n \n \tif (eol) {\n-\t\tspin_lock(&ua->proc->locks_spin);\n+\t\tspin_lock(&proc->locks_spin);\n \t\tif (!list_empty(&lkb->lkb_ownqueue)) {\n \t\t\tlist_del_init(&lkb->lkb_ownqueue);\n \t\t\tdlm_put_lkb(lkb);\n \t\t}\n-\t\tspin_unlock(&ua->proc->locks_spin);\n+\t\tspin_unlock(&proc->locks_spin);\n \t}\n  out:\n \tmutex_unlock(&ls->ls_clear_proc_locks);\n\n",
        "owner": "stoth68000",
        "repo": "media-tree",
        "source": "wild"
    },
  {
        "CVE_ID": "NA",
        "CWE_ID": "NA",
        "category": "non-security",
        "commit_id": "540958e2f5a87b81aa5f55ce40b3e2869754f97d",
        "commit_message": "commit 540958e2f5a87b81aa5f55ce40b3e2869754f97d\nAuthor: Raghavendra Ganiga <ravi23ganiga@gmail.com>\nDate:   Sat May 10 21:54:14 2014 +0530\n\n    staging: comedi: removing warnings reported by checkpatch tool on cb_pcimdas.c\n    \n    This is a patch to remove warnings reported\n    by checkpatch tool on cb_pcimdas.c file\n    \n    Signed-off-by: Raghavendra Chandra Ganiga <ravi23ganiga@gmail.com>\n    Reviewed-by: Ian Abbott <abbotti@mev.co.uk>\n    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>\n\n",
        "diff_code": "diff --git a/drivers/staging/comedi/drivers/cb_pcimdas.c b/drivers/staging/comedi/drivers/cb_pcimdas.c\nindex d3141c865fe7..50e522e6e690 100644\n--- a/drivers/staging/comedi/drivers/cb_pcimdas.c\n+++ b/drivers/staging/comedi/drivers/cb_pcimdas.c\n@@ -31,7 +31,8 @@ Configuration Options:\n \n Developed from cb_pcidas and skel by Richard Bytheway (mocelet@sucs.org).\n Only supports DIO, AO and simple AI in it's present form.\n-No interrupts, multi channel or FIFO AI, although the card looks like it could support this.\n+No interrupts, multi channel or FIFO AI,\n+although the card looks like it could support this.\n See http://www.mccdaq.com/PDFs/Manuals/pcim-das1602-16.pdf for more details.\n */\n \n@@ -128,8 +129,12 @@ static int cb_pcimdas_ai_rinsn(struct comedi_device *dev,\n \t\td = d & 0xfd;\n \t\toutb(d, devpriv->BADR3 + 5);\n \t}\n-\toutb(0x01, devpriv->BADR3 + 6);\t/* set bursting off, conversions on */\n-\toutb(0x00, devpriv->BADR3 + 7);\t/* set range to 10V. UP/BP is controlled by a switch on the board */\n+\n+\t/* set bursting off, conversions on */\n+\toutb(0x01, devpriv->BADR3 + 6);\n+\n+\t/* set range to 10V. UP/BP is controlled by a switch on the board */\n+\toutb(0x00, devpriv->BADR3 + 7);\n \n \t/*\n \t * write channel limits to multiplexer, set Low (bits 0-3) and\n\n",
        "owner": "stoth68000",
        "repo": "media-tree",
        "source": "wild"
    },
  {
        "CVE_ID": "NA",
        "CWE_ID": "NA",
        "category": "non-security",
        "commit_id": "64d240b721b21e266ffde645ec965c3b6d1c551f",
        "commit_message": "commit 64d240b721b21e266ffde645ec965c3b6d1c551f\nAuthor: Akinobu Mita <akinobu.mita@gmail.com>\nDate:   Mon Apr 13 23:21:58 2015 +0900\n\n    target/file: Fix UNMAP with DIF protection support\n    \n    When UNMAP command is issued with DIF protection support enabled,\n    the protection info for the unmapped region is remain unchanged.\n    So READ command for the region causes data integrity failure.\n    \n    This fixes it by invalidating protection info for the unmapped region\n    by filling with 0xff pattern.  This change also adds helper function\n    fd_do_prot_fill() in order to reduce code duplication with existing\n    fd_format_prot().\n    \n    Signed-off-by: Akinobu Mita <akinobu.mita@gmail.com>\n    Reviewed-by: Sagi Grimberg <sagig@mellanox.com>\n    Reviewed-by: \"Martin K. Petersen\" <martin.petersen@oracle.com>\n    Cc: Christoph Hellwig <hch@lst.de>\n    Cc: \"James E.J. Bottomley\" <James.Bottomley@HansenPartnership.com>\n    Cc: <stable@vger.kernel.org> # v3.14+\n    Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>\n\n",
        "diff_code": "diff --git a/drivers/target/target_core_file.c b/drivers/target/target_core_file.c\nindex 1284fec63db8..f7e6e51aed36 100644\n--- a/drivers/target/target_core_file.c\n+++ b/drivers/target/target_core_file.c\n@@ -482,6 +482,56 @@ fd_execute_write_same(struct se_cmd *cmd)\n \treturn 0;\n }\n \n+static int\n+fd_do_prot_fill(struct se_device *se_dev, sector_t lba, sector_t nolb,\n+\t\tvoid *buf, size_t bufsize)\n+{\n+\tstruct fd_dev *fd_dev = FD_DEV(se_dev);\n+\tstruct file *prot_fd = fd_dev->fd_prot_file;\n+\tsector_t prot_length, prot;\n+\tloff_t pos = lba * se_dev->prot_length;\n+\n+\tif (!prot_fd) {\n+\t\tpr_err(\"Unable to locate fd_dev->fd_prot_file\\n\");\n+\t\treturn -ENODEV;\n+\t}\n+\n+\tprot_length = nolb * se_dev->prot_length;\n+\n+\tfor (prot = 0; prot < prot_length;) {\n+\t\tsector_t len = min_t(sector_t, bufsize, prot_length - prot);\n+\t\tssize_t ret = kernel_write(prot_fd, buf, len, pos + prot);\n+\n+\t\tif (ret != len) {\n+\t\t\tpr_err(\"vfs_write to prot file failed: %zd\\n\", ret);\n+\t\t\treturn ret < 0 ? ret : -ENODEV;\n+\t\t}\n+\t\tprot += ret;\n+\t}\n+\n+\treturn 0;\n+}\n+\n+static int\n+fd_do_prot_unmap(struct se_cmd *cmd, sector_t lba, sector_t nolb)\n+{\n+\tvoid *buf;\n+\tint rc;\n+\n+\tbuf = (void *)__get_free_page(GFP_KERNEL);\n+\tif (!buf) {\n+\t\tpr_err(\"Unable to allocate FILEIO prot buf\\n\");\n+\t\treturn -ENOMEM;\n+\t}\n+\tmemset(buf, 0xff, PAGE_SIZE);\n+\n+\trc = fd_do_prot_fill(cmd->se_dev, lba, nolb, buf, PAGE_SIZE);\n+\n+\tfree_page((unsigned long)buf);\n+\n+\treturn rc;\n+}\n+\n static sense_reason_t\n fd_do_unmap(struct se_cmd *cmd, void *priv, sector_t lba, sector_t nolb)\n {\n@@ -489,6 +539,12 @@ fd_do_unmap(struct se_cmd *cmd, void *priv, sector_t lba, sector_t nolb)\n \tstruct inode *inode = file->f_mapping->host;\n \tint ret;\n \n+\tif (cmd->se_dev->dev_attrib.pi_prot_type) {\n+\t\tret = fd_do_prot_unmap(cmd, lba, nolb);\n+\t\tif (ret)\n+\t\t\treturn TCM_LOGICAL_UNIT_COMMUNICATION_FAILURE;\n+\t}\n+\n \tif (S_ISBLK(inode->i_mode)) {\n \t\t/* The backend is block device, use discard */\n \t\tstruct block_device *bdev = inode->i_bdev;\n@@ -811,48 +867,28 @@ static int fd_init_prot(struct se_device *dev)\n \n static int fd_format_prot(struct se_device *dev)\n {\n-\tstruct fd_dev *fd_dev = FD_DEV(dev);\n-\tstruct file *prot_fd = fd_dev->fd_prot_file;\n-\tsector_t prot_length, prot;\n \tunsigned char *buf;\n-\tloff_t pos = 0;\n \tint unit_size = FDBD_FORMAT_UNIT_SIZE * dev->dev_attrib.block_size;\n-\tint rc, ret = 0, size, len;\n+\tint ret;\n \n \tif (!dev->dev_attrib.pi_prot_type) {\n \t\tpr_err(\"Unable to format_prot while pi_prot_type == 0\\n\");\n \t\treturn -ENODEV;\n \t}\n-\tif (!prot_fd) {\n-\t\tpr_err(\"Unable to locate fd_dev->fd_prot_file\\n\");\n-\t\treturn -ENODEV;\n-\t}\n \n \tbuf = vzalloc(unit_size);\n \tif (!buf) {\n \t\tpr_err(\"Unable to allocate FILEIO prot buf\\n\");\n \t\treturn -ENOMEM;\n \t}\n-\tprot_length = (dev->transport->get_blocks(dev) + 1) * dev->prot_length;\n-\tsize = prot_length;\n \n \tpr_debug(\"Using FILEIO prot_length: %llu\\n\",\n-\t\t (unsigned long long)prot_length);\n+\t\t (unsigned long long)(dev->transport->get_blocks(dev) + 1) *\n+\t\t\t\t\tdev->prot_length);\n \n \tmemset(buf, 0xff, unit_size);\n-\tfor (prot = 0; prot < prot_length; prot += unit_size) {\n-\t\tlen = min(unit_size, size);\n-\t\trc = kernel_write(prot_fd, buf, len, pos);\n-\t\tif (rc != len) {\n-\t\t\tpr_err(\"vfs_write to prot file failed: %d\\n\", rc);\n-\t\t\tret = -ENODEV;\n-\t\t\tgoto out;\n-\t\t}\n-\t\tpos += len;\n-\t\tsize -= len;\n-\t}\n-\n-out:\n+\tret = fd_do_prot_fill(dev, 0, dev->transport->get_blocks(dev) + 1,\n+\t\t\t      buf, unit_size);\n \tvfree(buf);\n \treturn ret;\n }\n\n",
        "owner": "stoth68000",
        "repo": "media-tree",
        "source": "wild"
    }

]
